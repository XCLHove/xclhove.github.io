import{d as t,u as l,k,c as i,l as a,t as n,a as r,e,a3 as d,o as p}from"./chunks/framework.7ep0oyv4.js";const F=d(`<h1 id="docker部署openvpn" tabindex="-1">docker部署openvpn <a class="header-anchor" href="#docker部署openvpn" aria-label="Permalink to &quot;docker部署openvpn&quot;">​</a></h1><h2 id="拉取openvpn镜像" tabindex="-1">拉取openvpn镜像 <a class="header-anchor" href="#拉取openvpn镜像" aria-label="Permalink to &quot;拉取openvpn镜像&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji1506/openvpn:2.4.8</span></span></code></pre></div><h2 id="创建目录" tabindex="-1">创建目录 <a class="header-anchor" href="#创建目录" aria-label="Permalink to &quot;创建目录&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -pv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn/conf</span></span></code></pre></div><h2 id="生成配置文件" tabindex="-1">生成配置文件 <a class="header-anchor" href="#生成配置文件" aria-label="Permalink to &quot;生成配置文件&quot;">​</a></h2><p><em><strong>1.1.1.1</strong>是本机的公网IP，按需改成自己的IP</em></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn:/etc/openvpn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji1506/openvpn:2.4.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ovpn_genconfig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> udp://1.1.1.1</span></span></code></pre></div><h2 id="生成密钥文件" tabindex="-1">生成密钥文件 <a class="header-anchor" href="#生成密钥文件" aria-label="Permalink to &quot;生成密钥文件&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn:/etc/openvpn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji1506/openvpn:2.4.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ovpn_initpki</span></span></code></pre></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PEM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> phrase:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 123456</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">										# 输入私钥密码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		Verifying</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PEM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> phrase:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 123456</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">							# 重新输入一次密码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		Common</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (eg: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user,host,or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) [Easy-RSA CA]: 		</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输入一个CA名称。可以不用输入，直接回车</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> phrase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/openvpn/pki/private/ca.key:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 123456</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# 输入刚才设置的私钥密码，完成后在输入一次</span></span></code></pre></div><h2 id="生成客户端证书" tabindex="-1">生成客户端证书 <a class="header-anchor" href="#生成客户端证书" aria-label="Permalink to &quot;生成客户端证书&quot;">​</a></h2><p><em><strong>chenji</strong>改成其他名字</em></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn:/etc/openvpn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji1506/openvpn:2.4.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> easyrsa</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build-client-full</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nopass</span></span></code></pre></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> phrase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/openvpn/pki/private/ca.key:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 123456</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# 输入刚才设置的密码</span></span></code></pre></div><h2 id="导出客户端配置" tabindex="-1">导出客户端配置 <a class="header-anchor" href="#导出客户端配置" aria-label="Permalink to &quot;导出客户端配置&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn:/etc/openvpn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji1506/openvpn:2.4.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ovpn_getclient</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn/conf/chenji.ovpn</span></span></code></pre></div><h2 id="启动openvpn" tabindex="-1">启动openvpn <a class="header-anchor" href="#启动openvpn" aria-label="Permalink to &quot;启动openvpn&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openvpn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn:/etc/openvpn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1194:1194/udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cap-add=NET_ADMIN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji1506/openvpn:2.4.8</span></span></code></pre></div><h2 id="openvpn用户管理" tabindex="-1">openvpn用户管理 <a class="header-anchor" href="#openvpn用户管理" aria-label="Permalink to &quot;openvpn用户管理&quot;">​</a></h2><p><strong>添加用户脚本</strong></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add_user.sh</span></span></code></pre></div><p><code>add_user.sh</code>的内容：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>#!/bin/bash</span></span>
<span class="line"><span>read -p &quot;please your username: &quot; NAME</span></span>
<span class="line"><span>docker run -v /data/openvpn:/etc/openvpn --rm -it chenji1506/openvpn:2.4.8 easyrsa build-client-full $NAME nopass</span></span>
<span class="line"><span>docker run -v /data/openvpn:/etc/openvpn --rm chenji1506/openvpn:2.4.8 ovpn_getclient $NAME &gt; /data/openvpn/conf/&quot;$NAME&quot;.ovpn</span></span>
<span class="line"><span>docker restart openvpn</span></span></code></pre></div><p><strong>删除用户脚本</strong></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> del_user.sh</span></span></code></pre></div><p><code>del_user.sh</code>的内容:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">read</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Delete username: &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DNAME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn:/etc/openvpn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji1506/openvpn:2.4.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> easyrsa</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revoke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $DNAME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn:/etc/openvpn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji1506/openvpn:2.4.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> easyrsa</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gen-crl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn:/etc/openvpn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji1506/openvpn:2.4.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/openvpn/pki/reqs/&quot;DNAME&quot;.req</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn:/etc/openvpn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji1506/openvpn:2.4.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/openvpn/pki/private/&quot;DNAME&quot;.key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/openvpn:/etc/openvpn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chenji1506/openvpn:2.4.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/openvpn/pki/issued/&quot;DNAME&quot;.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openvpn</span></span></code></pre></div><p><strong>添加用户</strong></p><p>执行<code>add_user.sh</code></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./add_user.sh</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	# 输入要添加的用户名，回车后输入刚才创建的私钥密码</span></span></code></pre></div>`,31),o=["href"],g=["href"],c={key:1,style:{margin:"0 5px"}},C=["href"],E=JSON.parse('{"title":"docker部署openvpn","description":"","frontmatter":{"prev":{"text":"笔记","link":"/笔记"}},"headers":[],"params":{"id":86,"title":"docker部署openvpn","userId":1,"releaseTime":"2024-01-29T00:08:02.000+00:00","updateTime":"10/11/2024, 5:02:55 AM","isPublic":"公开","typeId":8,"sourceUrl":"https://xnote.xclhove.top/note/preview/86","prev":{"link":"./105#SpringBoot IOC容器初始化流程","text":"上一篇：SpringBoot IOC容器初始化流程"},"next":{"link":"./115#springboot2整合swagger2","text":"下一篇：springboot2整合swagger2"}},"relativePath":"note/86.md","filePath":"note/86.md"}'),y={name:"note/86.md"},m=t({...y,setup(v){const{params:h}=l();return k(()=>{document.title=h.value.title}),(s,u)=>(p(),i("div",null,[F,a("p",null,"最近更新："+n(s.$params.updateTime),1),a("p",null,[r("原文链接："),a("a",{target:"_blank",href:s.$params.sourceUrl},n(s.$params.title),9,o)]),a("span",null,[s.$params.prev?(p(),i("a",{key:0,class:"prev",href:s.$params.prev.link},n(s.$params.prev.text),9,g)):e("",!0),s.$params.prev&&s.$params.next?(p(),i("span",c,"|")):e("",!0),s.$params.next?(p(),i("a",{key:2,href:s.$params.next.link},n(s.$params.next.text),9,C)):e("",!0)])]))}});export{E as __pageData,m as default};
